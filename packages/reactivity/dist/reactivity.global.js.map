{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/dep.ts", "../src/effect.ts", "../src/baseHandlers.ts", "../src/reactive.ts"],
  "sourcesContent": ["export * from './reactive'\nexport * from './effect'", "export const isObject = (value) => {\n  return typeof value === 'object' && value !== null;\n}\n", "export type Dep = Set<any>;\n// \u4F7F\u7528Set\u5B58\u50A8\u552F\u4E00\u7684effect\nexport function createDep(effetcs?) {\n  const dep = new Set(effetcs);\n  return dep;\n}\n", "import { createDep, Dep } from \"./dep\";\n\n// \u5B58\u50A8\u65B9\u5F0F\u4E3A  WeakMap(target -> Map(key -> dep))\n// \u4F7F\u7528Set\u800C\u4E0D\u662F\u8BA2\u9605\u7684Dep\u7C7B\uFF0C\u662F\u4E3A\u4E86\u8282\u7701\u6027\u80FD\u5F00\u9500\ntype KeyToDepMap = Map<any, Dep>;\nconst targetMap = new WeakMap<any, KeyToDepMap>();\n\nexport let activeEffect: ReactiveEffect | undefined;\n\n// \u4F20\u5165\u7684\u6536\u96C6\u51FD\u6570\u4E0D\u4F1A\u9012\u5F52\u6267\u884C\n// effect\u8FD4\u56DE\u7684\u4E5F\u662F\u51FD\u6570\uFF0C\u53EF\u4EE5\u76F4\u63A5\u901A\u8FC7\u8FD4\u56DE\u7684\u51FD\u6570\u6267\u884C\u76D1\u542C\u51FD\u6570\n// effect\u53EF\u4EE5\u5305\u88F9effect\u8FD4\u56DE\u7684\u65B9\u6CD5\uFF0C\u4F1A\u91CD\u65B0\u5305\u88C5\uFF0C\u5F53\u89E6\u53D1\u65F6\u4F1A\u6267\u884C\u4E24\u6B21\n// effect\u53EF\u4EE5\u5728\u76D1\u542C\u51FD\u6570\u4E2D\u518D\u6B21\u8C03\u7528effect\uFF0C\u4F46\u91CC\u5916\u5C42\u4E0D\u4F1A\u4E92\u76F8\u6536\u96C6\u4F9D\u8D56\n// effect\u7B2C\u4E8C\u4E2A\u53C2\u6570\u53EF\u9009\uFF0C\u5305\u62EC lazy\u3001scheduler\u3001allowRecurse\u3001onStop\u3001onTrack\u3001onTrigger\n// lazy: boolean\uFF0C\u662F\u5426\u61D2\u52A0\u8F7D\uFF0C\u5982\u679C\u662Ftrue\u8C03\u7528effect\u4E0D\u4F1A\u7ACB\u5373\u6267\u884C\u76D1\u542C\u51FD\u6570\uFF0C\u7531\u7528\u6237\u624B\u52A8\u89E6\u53D1\u3002\n// scheduler: function\uFF0C\u88AB\u89E6\u53D1\u5F15\u8D77effect\u8981\u91CD\u65B0\u6536\u96C6\u4F9D\u8D56\u65F6\u7684\u8C03\u5EA6\u5668\uFF0C\u5F53\u4F20\u5165\u65F6effect\u6536\u5230\u89E6\u53D1\u65F6\u4E0D\u4F1A\u91CD\u65B0\u6267\u884C\u76D1\u542C\u51FD\u6570\u800C\u662F\u6267\u884C\u8FD9\u4E2Afunction\uFF0C\u7531\u7528\u6237\u81EA\u5DF1\u8C03\u5EA6\u3002\n// allowRecurse\uFF1Aboolean, \u662F\u5426\u5141\u8BB8\u9012\u5F52\uFF0C\u8FD9\u4E2A\u53C2\u6570\u9700\u8981\u548Cscheduler\u914D\u5957\u4F7F\u7528\uFF0C\u662F\u5426\u5141\u8BB8\u9012\u5F52scheduler\uFF0C\u5BF9\u76D1\u542C\u51FD\u6570\u65E0\u6548\u3002\n// onStop\uFF1A\u5F53effect\u88ABstop\uFF08\u505C\u6B62\u76D1\u542C\uFF09\u65F6\u7684\u94A9\u5B50\u3002\n// onTrack\uFF1A\u5F53effect\u88ABtrack\u65F6\u7684\u94A9\u5B50\u3002\n// onTrigger\uFF1A\u5F53effect\u88ABtrigger\u65F6\u7684\u94A9\u5B50\u3002\nexport class ReactiveEffect {\n  active = true; // \u7528\u4E8E\u6807\u8BC6\u662F\u5426\u88AB\u6FC0\u6D3B\n  deps: Dep[] = []; // \u7528\u4E8E\u5B58\u50A8\u5F53\u524Deffect\u6536\u96C6\u7684Dep\n  constructor(public fn) {}\n\n  run() {\n    // \u5982\u679C\u4E0D\u662F\u88AB\u6FC0\u6D3B\u7684\u72B6\u6001\uFF0C\u76F4\u63A5\u6267\u884C\u76D1\u542C\u51FD\u6570\n    if (!this.active) {\n      this.fn();\n    }\n\n    try {\n      // \u5F53\u524Deffet\uFF0C\u53EF\u88AB\u4F9D\u8D56\u6536\u96C6\n      activeEffect = this;\n      // \u5148\u6267\u884C\u4E00\u6B21\n      return this.fn();\n    } finally {\n      // \u4F9D\u8D56\u6536\u96C6\u5B8C\u6210\n      activeEffect = undefined;\n    }\n  }\n\n  stop() {}\n}\n\nexport interface ReactiveEffectRunner<T = any> {\n  (): T;\n  effect: ReactiveEffect;\n}\n\nexport function effect(fn) {\n  debugger\n  const _effect = new ReactiveEffect(fn);\n  // \u9996\u5148\u6267\u884C\u4E00\u6B21\uFF0C\u6536\u96C6\u4F9D\u8D56\n  _effect.run();\n\n  // \u5B58\u50A8\u76D1\u542C\u51FD\u6570\u5E76\u8FD4\u56DE\uFF0C\u8FD4\u56DE\u7684\u76D1\u542C\u51FD\u6570\u53EF\u4EE5\u4F9B\u968F\u65F6\u8C03\u7528\u3002\n  const runner = _effect.run.bind(_effect) as ReactiveEffectRunner;\n  runner.effect = _effect;\n  return runner;\n}\n\n// \u6536\u96C6\nexport function track(target: object, key: unknown) {\n  // \u5982\u679C\u6709\u53EF\u88AB\u6536\u96C6\u7684\u4F9D\u8D56\n  if (activeEffect) {\n    // \u5B58\u50A8\u65B9\u5F0F WeakMap(target -> Map(key -> dep)) dep\u4E2D\u5B58\u50A8\u7684\u4E3AReactiveEffect\u5BF9\u8C61\n    let depsMap = targetMap.get(target);\n    if (!depsMap) {\n      targetMap.set(target, (depsMap = new Map()));\n    }\n    let dep = depsMap.get(key);\n    if (!dep) {\n      depsMap.set(key, (dep = createDep()));\n    }\n\n    trackEffects(dep);\n  }\n}\nfunction trackEffects(dep: Dep) {\n  dep.add(activeEffect!); // ! \u4E3ATS\u975E\u7A7A\u65AD\u8A00\n  activeEffect!.deps.push(dep);\n}\n\n// \u89E6\u53D1\nexport function trigger(target: object, key?: unknown, value?: unknown) {\n  const depsMap = targetMap.get(target);\n  // \u5982\u679C\u6CA1\u6709\u88AB\u6536\u96C6\u8FC7\uFF0C\u76F4\u63A5\u9000\u51FA\n  if (!depsMap) return;\n\n  let deps: (Dep | undefined)[] = [];\n\n  // \u4E0D\u4F7F\u7528undefined\u7684\u539F\u56E0\u662F\uFF0C\u6709\u4E9B\u6D4F\u89C8\u5668\u5BF9\u4E8Eundefined\u4E0D\u662F\u4FDD\u7559\u5B57\u6216\u5173\u952E\u5B57\uFF0C\u53EF\u5BF9\u5176\u8FDB\u884C\u4FEE\u6539\u3002\u800Cvoid 0\u8FD4\u56DE\u7684\u662F\u7EAF\u6B63\u7684undefined\n  // \u5982\u679Ckey\u6709\u503C\uFF0C\u5C06\u83B7\u53D6\u5230\u7684dep\u653E\u5165\u5230deps\u4E2D\u3002\n  if (key !== void 0) {\n    deps.push(depsMap.get(key));\n  }\n\n  if (deps.length === 1) {\n    triggerEffects(deps[0]);\n  }\n}\nfunction triggerEffects(dep: Dep) {\n  // \u7EDF\u4E00\u4E3A\u6570\u7EC4\u7C7B\u578B\n  const effects = Array.isArray(dep) ? dep : [...dep];\n  for (const effect of effects) {\n    triggerEffect(effect);\n  }\n}\n\nfunction triggerEffect(effect: ReactiveEffect) {\n  effect.run();\n}\n", "import { isObject } from '../../shared/src/index';\nimport { track, trigger } from './effect';\nimport { reactive, ReactiveFlags } from './reactive';\nconst get = createGetter();\nconst set = createSetter();\n\nexport const mutableHandlers: ProxyHandler<object> = {\n  get,\n  set,\n  // deleteProperty,\n  // has,\n  // ownKeys\n};\n\nfunction createGetter() {\n  return function get(target, key) {\n    if (key === ReactiveFlags.IS_REACTIVE) { // \u662F\u5426\u88AB\u4EE3\u7406\u7684\u6807\u8BC6\u3002\n      return true;\n    }\n    const res = Reflect.get(target, key)\n    // \u6536\u96C6\u4F9D\u8D56 \u521B\u5EFAdep -> effects\u4E2D\u63D2\u5165 -> effect\n    track(target, key)\n\n    // \u5982\u679C\u662F\u5BF9\u8C61\uFF0C\u4E5F\u8F6C\u4E3A\u4EE3\u7406\n    if (isObject(res)) {\n      return reactive(res)\n    }\n    return res\n  }\n}\nfunction createSetter() {\n  return function set(target, key, value) {\n    const result = Reflect.set(target, key, value)\n    // \u89E6\u53D1\u4F9D\u8D56 \u627E\u5230dep -> \u904D\u5386effects -> \u6267\u884C\u6BCF\u4E00\u4E2Aeffect\n    trigger(target, key, value)\n    return result\n  }\n}\n", "import { isObject } from \"@vue/shared\";\nimport { mutableHandlers } from \"./baseHandlers\";\n\nexport const enum ReactiveFlags {\n  // \u662F\u5426\u662Freactive\u7684\u6807\u8BC6\u3002\u901A\u8FC7\u5176\u6765\u5224\u65AD\u662F\u5426\u88ABproxy\u4EE3\u7406\u8FC7\u3002\u5426\u5219\u9700\u8981\u6539\u5199[Symbol.toStringTag]\u503C\u624D\u65B9\u4FBF\u5224\u65AD\u3002\n  // \u6CA1\u6709\u8D4B\u503C\u64CD\u4F5C\uFF0C\u662F\u5728\u4EE3\u7406\u7684get\u51FD\u6570\u4E2D\u5224\u65AD\u7684\u3002\n  IS_REACTIVE = \"__v_isReactive\",\n}\n\nexport interface Target {\n  [ReactiveFlags.IS_REACTIVE]: boolean;\n}\n\nconst reactiveMap = new WeakMap<Target, any>();\n\n// export function reactive<T extends object>(target: T): ProxyConstructor;\nexport function reactive(target) {\n  return createReactive(target, mutableHandlers, reactiveMap);\n}\n\nfunction createReactive(\n  target: any,\n  baseHandlers: ProxyHandler<any>,\n  proxyMap\n) {\n  // \u5982\u679C\u4E0D\u662F\u5BF9\u8C61\uFF0C\u76F4\u63A5\u8FD4\u56DE\n  if (!isObject(target)) {\n    return target;\n  }\n\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target\n  }\n\n  // \u5DF2\u5728Map\u4E2D\u7F13\u5B58\u7684\u76F4\u63A5\u4F7F\u7528\n  const existingProxy = proxyMap.get(target);\n  if (existingProxy) {\n    return existingProxy;\n  }\n\n  // \u4F7F\u7528proxy\u4EE3\u7406\n  const proxy = new Proxy(target, baseHandlers);\n  // \u5B58\u50A8\u5230Map\u4E2D\n  proxyMap.set(target, proxy);\n\n  return proxy;\n}\n\nexport function isReactive(value): boolean {\n  // \u8F6C\u4E3A\u5E03\u5C14\u503C\n  return !!(value && value[ReactiveFlags.IS_REACTIVE])\n}\n"],
  "mappings": "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",
  "names": []
}
